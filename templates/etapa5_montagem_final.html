{% extends "layout.html" %}
{% block content %}
    <h1>Etapa 5: Montagem do V칤deo Final</h1>

    <!-- Sec칞칚o de Gerenciamento dos V칤deos Base -->
    <div class="status {% if status.videos_base %}completo{% else %}pendente{% endif %}" style="margin-bottom: 2em;">
        <h3>V칤deos Base Dispon칤veis ({{ status.videos_base|length }})</h3>
        {% if status.videos_base %}
            <p>Estes s칚o os clipes que ser칚o usados na montagem final. Voc칡 pode remover os que n칚o desejar.</p>
            
            <form action="{{ url_for('excluir', etapa='videos_base') }}" method="post">
                <div style="max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px;">
                {% for video in status.videos_base %}
                    <label><input type="checkbox" name="arquivos_selecionados" value="{{ video }}"> {{ video }}</label><br>
                {% endfor %}
                </div>
                <button type="submit" name="action" value="delete_selected" onclick="return confirm('Tem certeza que deseja excluir os v칤deos selecionados?')" style="background-color: #dc3545; color: white;">Excluir Selecionados</button>
                <button type="submit" name="action" value="delete_all" onclick="return confirm('ATEN칂츾O: Isso excluir치 TODOS os v칤deos base. Tem certeza?')" style="background-color: #6c757d; color: white;">Excluir Todos</button>
            </form>
        {% else %}
            <p>Nenhum v칤deo base encontrado. Volte para a Etapa 4 para ger치-los.</p>
        {% endif %}
    </div>

    <!-- Sec칞칚o de Montagem do V칤deo Final -->
    {% if status.video_final %}
        <div class="status completo">
            <h3>Seu v칤deo final est치 pronto!</h3>
            <p>Ficheiro: {{ status.video_final }}</p>
            
            <video width="640" height="360" controls>
                <source src="{{ url_for('serve_final_video', filename=status.video_final) }}" type="video/mp4">
                Seu navegador n칚o suporta a tag de v칤deo.
            </video>
            <br><br>
            <a href="{{ url_for('serve_final_video', filename=status.video_final) }}" download style="padding: 10px; background-color: #007bff; color: white; text-decoration: none;">
                Baixar V칤deo
            </a>
            <form action="{{ url_for('excluir', etapa='video_final') }}" method="post" style="display: inline-block; margin-left: 20px;">
                 <input type="hidden" name="action" value="delete_all">
                <button type="submit" onclick="return confirm('Isso excluir치 o v칤deo final. Deseja recome칞ar a montagem?')" style="padding: 10px; background-color: red; color: white; border: none; cursor: pointer;">
                    Excluir e Recome칞ar Montagem
                </button>
            </form>
        </div>
    {% else %}
        <!-- S칩 mostra o bot칚o de montar se houver v칤deos base e narra칞칚o -->
        {% if status.videos_base and status.narracao %}
        <div class="status pendente">
            <p>Todos os componentes est칚o prontos para a montagem final.</p>
            <ul>
                <li><strong>Narra칞칚o:</strong> {{ status.narracao }}</li>
                <li><strong>V칤deos Base:</strong> {{ status.videos_base|length }} clipes selecionados</li>
            </ul>
            <p>Clique no bot칚o abaixo para juntar tudo e criar o v칤deo completo.</p>
            <br>
            <form action="{{ url_for('etapa5_montagem_final') }}" method="post">
                <button type="submit" style="padding: 15px; font-size: 16px;">
                    游 Montar V칤deo Final
                </button>
            </form>
        </div>
        {% endif %}
    {% endif %}
{% endblock %}
